{% extends "base.html" %}
{% block title %}Nieuwe inkoopfactuur{% endblock %}
{% block content %}
<div class="page-header">
    <h2><i class="bi bi-plus-lg"></i> Nieuwe inkoopfactuur</h2>
    <a href="{{ url_for('inkoopfacturen.lijst') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Terug
    </a>
</div>

<form method="post" action="{{ url_for('inkoopfacturen.nieuw') }}">
    <div class="card mb-4">
        <div class="card-header"><strong>Factuurgegevens</strong></div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Leverancier *</label>
                    <select name="leverancier_id" class="form-select" required>
                        <option value="">Selecteer...</option>
                        {% for l in leveranciers %}
                        <option value="{{ l.id }}">{{ l.naam }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Factuurnummer *</label>
                    <input type="text" name="factuurnummer" class="form-control" required placeholder="Van leverancier">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Factuurdatum *</label>
                    <input type="date" name="factuurdatum" class="form-control" required value="{{ vandaag }}">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Vervaldatum *</label>
                    <input type="date" name="vervaldatum" class="form-control" required value="{{ vervaldatum }}">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Valuta</label>
                    <select name="valuta" class="form-select">
                        {% for v in valutas %}
                        <option value="{{ v.code }}" {% if v.code == 'EUR' %}selected{% endif %}>{{ v.code }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong>Factuurregels</strong>
            <button type="button" class="btn btn-sm btn-outline-primary" onclick="voegRegelToe()">
                <i class="bi bi-plus-lg"></i> Regel toevoegen
            </button>
        </div>
        <div class="card-body" id="factuur-regels">
            <div class="factuur-regel" data-index="0">
                <div class="row g-2">
                    <div class="col-md-4">
                        <label class="form-label">Omschrijving</label>
                        <input type="text" name="omschrijving[]" class="form-control" required>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label">Aantal</label>
                        <input type="number" name="aantal[]" class="form-control regel-aantal" step="0.01" value="1" min="0">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Prijs per stuk</label>
                        <input type="number" name="prijs_per_stuk[]" class="form-control regel-prijs" step="0.01" value="0.00" min="0">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">BTW %</label>
                        <select name="btw_percentage[]" class="form-select regel-btw">
                            <option value="21">21%</option>
                            <option value="9">9%</option>
                            <option value="0">0%</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Grootboek</label>
                        <select name="grootboekrekening_id[]" class="form-select">
                            <option value="">-</option>
                            {% for r in rekeningen %}
                            <option value="{{ r.id }}">{{ r.code }} - {{ r.naam }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <div class="regel-totaal fw-bold">&euro; 0.00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <div class="row justify-content-end">
                <div class="col-md-4">
                    <table class="table table-sm mb-0">
                        <tr><td>Subtotaal:</td><td class="text-end" id="subtotaal">&euro; 0.00</td></tr>
                        <tr><td>BTW:</td><td class="text-end" id="btw-totaal">&euro; 0.00</td></tr>
                        <tr class="fw-bold fs-5"><td>Totaal:</td><td class="text-end" id="totaal">&euro; 0.00</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <label class="form-label">Opmerkingen</label>
            <textarea name="opmerkingen" class="form-control" rows="3"></textarea>
        </div>
    </div>

    <button type="submit" class="btn btn-primary btn-lg">
        <i class="bi bi-check-lg"></i> Inkoopfactuur registreren
    </button>
</form>

<template id="regel-template">
    <div class="factuur-regel">
        <div class="row g-2">
            <div class="col-md-4">
                <input type="text" name="omschrijving[]" class="form-control" placeholder="Omschrijving" required>
            </div>
            <div class="col-md-1">
                <input type="number" name="aantal[]" class="form-control regel-aantal" step="0.01" value="1" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" name="prijs_per_stuk[]" class="form-control regel-prijs" step="0.01" value="0.00" min="0">
            </div>
            <div class="col-md-2">
                <select name="btw_percentage[]" class="form-select regel-btw">
                    <option value="21">21%</option>
                    <option value="9">9%</option>
                    <option value="0">0%</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="grootboekrekening_id[]" class="form-select">
                    <option value="">-</option>
                    {% for r in rekeningen %}
                    <option value="{{ r.id }}">{{ r.code }} - {{ r.naam }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-1 d-flex align-items-end justify-content-between">
                <div class="regel-totaal fw-bold">&euro; 0.00</div>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="verwijderRegel(this)">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>
    </div>
</template>
{% endblock %}
